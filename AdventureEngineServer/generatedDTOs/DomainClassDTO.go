//*** CAUTION ***
//This is an autogenerated file produced by regenerateBackend.py.
//Edits made here will not persist after backend regeneration.

package generatedDTOs

import (
   contextProviders "AdventureEngineServer/contextProviders"
   types "AdventureEngineServer/generatedDatabaseTypes"
   utils "AdventureEngineServer/utils"
   services "AdventureEngineServer/generatedServices"
   "errors"
   "fmt"
   "reflect"
   "slices"
)

type DomainClassDTOAttributes struct {
   AbbreviatedTitle *string
   CreatedAt *string
   Description *string
   
   IsActive *bool
   Title *string
   UpdatedAt *string
}

type DomainClassDTOManyToOneRelationships struct {
   HitDie__DomainDice *DomainDiceDTO
   ResourceOwner__User *UserDTO
   SpellcastingStat__DomainCharacterStat *DomainCharacterStatDTO
}

type DomainClassDTOOneToManyRelationships struct {
   PrimaryStats__ClassPrimaryAbility []*ClassPrimaryAbilityDTO
   Saves__ClassSave []*ClassSaveDTO
   SubClasses__DomainSubClass []*DomainSubClassDTO
}

type DomainClassDTORelationships struct {
   ManyToOne DomainClassDTOManyToOneRelationships
   OneToMany DomainClassDTOOneToManyRelationships
}

type DomainClassDTO struct {
   Id *int
   
   Attributes DomainClassDTOAttributes
   
   Relationships DomainClassDTORelationships
}

func DomainClassToDomainClassDTO(context *contextProviders.DTOContext, domainClass *types.DomainClass) (*DomainClassDTO, error) {
   if context == nil {
      return nil, errors.New("No DTO context provided")
   }
   
   if (domainClass == nil) {
      return nil, errors.New("Cannot convert nil pointer passed to DTO conversion for table DomainClass")
   }
   
   if (slices.Contains(context.TraversedTables, reflect.TypeOf(*domainClass).Name())) {
      fmt.Println("Hit circular catch case for table DomainClass")
      return nil, nil
   }
   
   childDTOContext := contextProviders.DTOContext{
      DatabaseContext: context.DatabaseContext,
      TraversedTables: append(context.TraversedTables, reflect.TypeOf(*domainClass).Name()),
   }
   serviceContext := &contextProviders.ServiceContext{
      DatabaseContext: context.DatabaseContext,
      CurrentUser: nil,
   }
   
   var includedHitDie__DomainDice *types.DomainDice
   var includedResourceOwner__User *types.User
   var includedSpellcastingStat__DomainCharacterStat *types.DomainCharacterStat
   var includedPrimaryStats__ClassPrimaryAbilitys []types.ClassPrimaryAbility
   var includedSaves__ClassSaves []types.ClassSave
   var includedSubClasses__DomainSubClasss []types.DomainSubClass
   
   var HitDie__DomainDiceDTO *DomainDiceDTO
   var ResourceOwner__UserDTO *UserDTO
   var SpellcastingStat__DomainCharacterStatDTO *DomainCharacterStatDTO
   var PrimaryStats__ClassPrimaryAbilityDTOs []*ClassPrimaryAbilityDTO
   var Saves__ClassSaveDTOs []*ClassSaveDTO
   var SubClasses__DomainSubClassDTOs []*DomainSubClassDTO
   
   var err error
   
   if (domainClass.HitDie__DomainDice != nil) {
      includedHitDie__DomainDice, err = services.GetDomainDiceById(serviceContext, contextProviders.ProduceGetByIdArgs[types.DomainDice](domainClass.HitDie__DomainDice))
      if err != nil {
         return nil, err
      }
      HitDie__DomainDiceDTO, err = DomainDiceToDomainDiceDTO(&childDTOContext, includedHitDie__DomainDice)
      if err != nil {
         return nil, err
      }
   }

   if (domainClass.ResourceOwner__User != nil) {
      includedResourceOwner__User, err = services.GetUserById(serviceContext, contextProviders.ProduceGetByIdArgs[types.User](domainClass.ResourceOwner__User))
      if err != nil {
         return nil, err
      }
      ResourceOwner__UserDTO, err = UserToUserDTO(&childDTOContext, includedResourceOwner__User)
      if err != nil {
         return nil, err
      }
   }

   if (domainClass.SpellcastingStat__DomainCharacterStat != nil) {
      includedSpellcastingStat__DomainCharacterStat, err = services.GetDomainCharacterStatById(serviceContext, contextProviders.ProduceGetByIdArgs[types.DomainCharacterStat](domainClass.SpellcastingStat__DomainCharacterStat))
      if err != nil {
         return nil, err
      }
      SpellcastingStat__DomainCharacterStatDTO, err = DomainCharacterStatToDomainCharacterStatDTO(&childDTOContext, includedSpellcastingStat__DomainCharacterStat)
      if err != nil {
         return nil, err
      }
   }

   if (slices.Contains(context.TraversedTables, reflect.TypeOf(includedPrimaryStats__ClassPrimaryAbilitys).Elem().Name())) {
      includedPrimaryStats__ClassPrimaryAbilitys = []types.ClassPrimaryAbility{}
      fmt.Println("Hit circular catch case for table ClassPrimaryAbility")
   } else {
      includedPrimaryStats__ClassPrimaryAbilitys, err = services.GetClassPrimaryAbilitys(serviceContext, contextProviders.ProduceGetArgs[types.ClassPrimaryAbility]("Class__DomainClass", domainClass.Id))
      if err != nil {
         return nil, err
      }
      PrimaryStats__ClassPrimaryAbilityDTOs, err = utils.ErrorCompatibleMap(includedPrimaryStats__ClassPrimaryAbilitys, func(relationshipElement types.ClassPrimaryAbility) (*ClassPrimaryAbilityDTO, error) { return ClassPrimaryAbilityToClassPrimaryAbilityDTO(&childDTOContext, &relationshipElement) })
      if err != nil {
         return nil, err
      }
   }

   if (slices.Contains(context.TraversedTables, reflect.TypeOf(includedSaves__ClassSaves).Elem().Name())) {
      includedSaves__ClassSaves = []types.ClassSave{}
      fmt.Println("Hit circular catch case for table ClassSave")
   } else {
      includedSaves__ClassSaves, err = services.GetClassSaves(serviceContext, contextProviders.ProduceGetArgs[types.ClassSave]("Class__DomainClass", domainClass.Id))
      if err != nil {
         return nil, err
      }
      Saves__ClassSaveDTOs, err = utils.ErrorCompatibleMap(includedSaves__ClassSaves, func(relationshipElement types.ClassSave) (*ClassSaveDTO, error) { return ClassSaveToClassSaveDTO(&childDTOContext, &relationshipElement) })
      if err != nil {
         return nil, err
      }
   }

   if (slices.Contains(context.TraversedTables, reflect.TypeOf(includedSubClasses__DomainSubClasss).Elem().Name())) {
      includedSubClasses__DomainSubClasss = []types.DomainSubClass{}
      fmt.Println("Hit circular catch case for table DomainSubClass")
   } else {
      includedSubClasses__DomainSubClasss, err = services.GetDomainSubClasss(serviceContext, contextProviders.ProduceGetArgs[types.DomainSubClass]("Class__DomainClass", domainClass.Id))
      if err != nil {
         return nil, err
      }
      SubClasses__DomainSubClassDTOs, err = utils.ErrorCompatibleMap(includedSubClasses__DomainSubClasss, func(relationshipElement types.DomainSubClass) (*DomainSubClassDTO, error) { return DomainSubClassToDomainSubClassDTO(&childDTOContext, &relationshipElement) })
      if err != nil {
         return nil, err
      }
   }

   
   return &DomainClassDTO{
      Id: domainClass.Id,
      Attributes: DomainClassDTOAttributes{
         AbbreviatedTitle: domainClass.AbbreviatedTitle,
         CreatedAt: domainClass.CreatedAt,
         Description: domainClass.Description,
         
         IsActive: domainClass.IsActive,
         Title: domainClass.Title,
         UpdatedAt: domainClass.UpdatedAt,
      },
      Relationships: DomainClassDTORelationships{
         ManyToOne: DomainClassDTOManyToOneRelationships {
            HitDie__DomainDice: HitDie__DomainDiceDTO,
            ResourceOwner__User: ResourceOwner__UserDTO,
            SpellcastingStat__DomainCharacterStat: SpellcastingStat__DomainCharacterStatDTO,
         },
         OneToMany: DomainClassDTOOneToManyRelationships {
            PrimaryStats__ClassPrimaryAbility: PrimaryStats__ClassPrimaryAbilityDTOs,
            Saves__ClassSave: Saves__ClassSaveDTOs,
            SubClasses__DomainSubClass: SubClasses__DomainSubClassDTOs,
         },
      },
   }, nil
}

func DomainClassDTOToDomainClass(domainClass *DomainClassDTO) *types.DomainClass {
   var tableTypeBuffer types.DomainClass
   
   tableTypeBuffer.Id = domainClass.Id
   tableTypeBuffer.AbbreviatedTitle = domainClass.Attributes.AbbreviatedTitle
   tableTypeBuffer.CreatedAt = domainClass.Attributes.CreatedAt
   tableTypeBuffer.Description = domainClass.Attributes.Description
   
   tableTypeBuffer.IsActive = domainClass.Attributes.IsActive
   tableTypeBuffer.Title = domainClass.Attributes.Title
   tableTypeBuffer.UpdatedAt = domainClass.Attributes.UpdatedAt
   
   if (domainClass.Relationships.ManyToOne.HitDie__DomainDice != nil) {
      tableTypeBuffer.HitDie__DomainDice = domainClass.Relationships.ManyToOne.HitDie__DomainDice.Id
   }

   if (domainClass.Relationships.ManyToOne.ResourceOwner__User != nil) {
      tableTypeBuffer.ResourceOwner__User = domainClass.Relationships.ManyToOne.ResourceOwner__User.Id
   }

   if (domainClass.Relationships.ManyToOne.SpellcastingStat__DomainCharacterStat != nil) {
      tableTypeBuffer.SpellcastingStat__DomainCharacterStat = domainClass.Relationships.ManyToOne.SpellcastingStat__DomainCharacterStat.Id
   }

   return &tableTypeBuffer
}
