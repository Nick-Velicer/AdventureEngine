//*** CAUTION ***
//This is an autogenerated file produced by regenerateBackend.py.
//Edits made here will not persist after backend regeneration.

package generatedControllers
import (
   "github.com/gin-gonic/gin"
   "github.com/gin-gonic/gin/binding"
   "gorm.io/gorm"
   "strconv"
   "net/http"
   services "AdventureEngineServer/generatedServices"
   types "AdventureEngineServer/generatedDatabaseTypes"
   dtos "AdventureEngineServer/generatedDTOs"
   utils "AdventureEngineServer/utils"
)

func GetCharacterDomainSubClassInstances(ctx *gin.Context, db *gorm.DB) {
   var serviceBuffer []types.CharacterDomainSubClassInstance
   err := services.GetCharacterDomainSubClassInstances(db, &serviceBuffer)
   if err != nil {
      ctx.IndentedJSON(http.StatusInternalServerError, err.Error())
      return
   }
   
   var returnBuffer []dtos.CharacterDomainSubClassInstanceDTO
   for _, dbTypeInstance := range serviceBuffer {
      pointerToDTO := dtos.CharacterDomainSubClassInstanceToCharacterDomainSubClassInstanceDTO(db, &dbTypeInstance, []string{})
      if (pointerToDTO != nil) {
         returnBuffer = append(returnBuffer, *pointerToDTO)
      }
   }
   ctx.IndentedJSON(http.StatusOK, returnBuffer)
}

func GetCharacterDomainSubClassInstanceById(ctx *gin.Context, db *gorm.DB) {
   id := ctx.Param("id")
   idNum, err := strconv.Atoi(id)
   if err != nil {
      ctx.IndentedJSON(http.StatusInternalServerError, err.Error())
      return
   }
   var serviceBuffer types.CharacterDomainSubClassInstance
   err = services.GetCharacterDomainSubClassInstanceById(db, idNum, &serviceBuffer)
   if err != nil {
      ctx.IndentedJSON(http.StatusInternalServerError, err.Error())
      return
   }
   
   returnBuffer := dtos.CharacterDomainSubClassInstanceToCharacterDomainSubClassInstanceDTO(db, &serviceBuffer, []string{})
   ctx.IndentedJSON(http.StatusOK, returnBuffer)
}

func SaveCharacterDomainSubClassInstance(ctx *gin.Context, db *gorm.DB) {
   //Weirdness with unmarshalling, cannot unmarshal into a nil pointer, there must be some pre-initialization somewhere along the line
   var DTOBuffer *dtos.CharacterDomainSubClassInstanceDTO = &dtos.CharacterDomainSubClassInstanceDTO{}
   var batchDTOBuffer []*dtos.CharacterDomainSubClassInstanceDTO
   var serviceBuffer []*types.CharacterDomainSubClassInstance
   
   //If neither a single item nor a collection can be bound to JSON, fail early
   //ShouldBindBodyWith is used instead of ShouldBindJSON since the latter prevents multiple bind attempts
   if err := ctx.ShouldBindBodyWith(DTOBuffer, binding.JSON); err == nil {
      
      serviceBuffer = []*types.CharacterDomainSubClassInstance{dtos.CharacterDomainSubClassInstanceDTOToCharacterDomainSubClassInstance(DTOBuffer)}
      if err := services.SaveCharacterDomainSubClassInstance(db, serviceBuffer); err != nil {
         ctx.IndentedJSON(http.StatusInternalServerError, err.Error())
         return
      }
      
      returnBuffer := dtos.CharacterDomainSubClassInstanceToCharacterDomainSubClassInstanceDTO(db, serviceBuffer[0], []string{})
      
      ctx.IndentedJSON(http.StatusOK, returnBuffer)
      return
      
   } else if err := ctx.ShouldBindBodyWith(&batchDTOBuffer, binding.JSON); err == nil {
      
      serviceBuffer = utils.Map(batchDTOBuffer, func(dto *dtos.CharacterDomainSubClassInstanceDTO) *types.CharacterDomainSubClassInstance { return dtos.CharacterDomainSubClassInstanceDTOToCharacterDomainSubClassInstance(dto) })
      if err := services.SaveCharacterDomainSubClassInstance(db, serviceBuffer); err != nil {
         ctx.IndentedJSON(http.StatusInternalServerError, err.Error())
         return
      }
      
      returnBuffer := utils.Map(serviceBuffer, func(dbReturn *types.CharacterDomainSubClassInstance) *dtos.CharacterDomainSubClassInstanceDTO { return dtos.CharacterDomainSubClassInstanceToCharacterDomainSubClassInstanceDTO(db, dbReturn, []string{}) })
      
      ctx.IndentedJSON(http.StatusOK, returnBuffer)
      return
      
   } else {
      ctx.IndentedJSON(http.StatusBadRequest, err.Error())
      return
   }
}
