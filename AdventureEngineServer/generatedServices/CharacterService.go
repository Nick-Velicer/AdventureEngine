//*** CAUTION ***
//This is an autogenerated file produced by regenerateBackend.py.
//Edits made here will not persist after backend regeneration.

package generatedServices
import (
   "errors"
   "reflect"
   contextProviders "AdventureEngineServer/contextProviders"
   types "AdventureEngineServer/generatedDatabaseTypes"
   utils "AdventureEngineServer/utils"
)

func GetCharacters(context *contextProviders.ServiceContext, args *contextProviders.GetArgs[types.Character]) (contextProviders.GetReturn[types.Character], error) {
   if context == nil {
      return nil, errors.New("No service context provided")
   }
   
   if args == nil {
      return nil, errors.New("No service arguments provided")
   }
   
   if context.DatabaseContext == nil {
      return nil, errors.New("Cannot perform get action on nil database context")
   }
   
   var returnBuffer []types.Character
   
   filteredContext, err := utils.FilterTableContext(context.DatabaseContext.Table("Character"), args.Filters)
   
   if err != nil {
      return nil, err
   }
   result := filteredContext.Find(&returnBuffer)
   
   if result.Error != nil {
      return nil, result.Error
   }
   
   return returnBuffer, nil
}

func GetCharacterById(context *contextProviders.ServiceContext, args *contextProviders.GetByIdArgs[types.Character]) (contextProviders.GetByIdReturn[types.Character], error) {
   if context == nil {
      return nil, errors.New("No service context provided")
   }
   
   if args == nil {
      return nil, errors.New("No service arguments provided")
   }
   
   if context.DatabaseContext == nil {
      return nil, errors.New("Cannot perform get by id action on nil database context")
   }
   
   var returnPtr *types.Character
   result := context.DatabaseContext.Table("Character").First(returnPtr, args.Id)
   if result.Error != nil {
      return nil, result.Error
   }
   
   return returnPtr, nil
}

func SaveCharacter(context *contextProviders.ServiceContext, args *contextProviders.SaveArgs[types.Character]) (contextProviders.SaveReturn[types.Character], error) {
   if context == nil {
      return nil, errors.New("No service context provided")
   }
   
   if args == nil {
      return nil, errors.New("No service arguments provided")
   }
   
   if context.DatabaseContext == nil {
      return nil, errors.New("Cannot perform save action on nil database context")
   }
   
   tx := context.DatabaseContext.Begin()
   
   if tx.Error != nil {
      return nil, errors.New("Could not initialize transaction to save " + reflect.TypeOf(args.Items).Name() + " entity")
   }
   
   defer func() {
      if r := recover(); r != nil {
         tx.Rollback()
      }
   }()
   
   if err := tx.Error; err != nil {
      return nil, err
   }
   
   if err := tx.Table("Character").Save(args.Items).Error; err != nil {
      tx.Rollback()
      return nil, err
   }
   if tx.Commit().Error != nil {
      return nil, tx.Commit().Error
   }
   
   return args.Items, nil
}
